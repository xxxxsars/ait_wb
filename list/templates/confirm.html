{% extends "base.html" %}
{% load staticfiles %}
{% load filter %}


{% block css %}
    <style>
        h3 {
            text-align: center;
        }


    </style>
{% endblock %}



{% block js %}
    <script>

        $(function () {
            <!--pass value to download needs-->

            $("#export_form").one("submit", function (e) {
                var task_name = {{ task_names | safe }};
                var ini_content = '{{ render_str |escapejs }}';

                $(this).append('<input  id="task_list" type="hidden" name="task_list"/>');
                $("#task_list").val(task_name);


                $(this).append('<input  id="ini_content" type="hidden" name="ini_content"/>');
                $("#ini_content").val(ini_content);

                {% if chose_map %}
                    var chose_files = JSON.stringify({{ chose_map |safe }});
                    $(this).append('<input  id="chose_files" type="hidden" name="chose_files" />');
                    $("#chose_files").val(chose_files);
                {% endif %}
            });
        });


        $(document).ready(function () {


            <!--pass value to chose needs-->
            $("#chose_form").one("submit", function (e) {

                var task_name = {{ task_names | safe }};
                var ini_content = '{{ render_str |escapejs }}';
                var conflict_files = {{ cf_tasks.keys|get_list|safe  }}

                    $(this).append('<input  id="task_list" type="hidden" name="task_list"/>');
                $("#task_list").val(task_name);


                $(this).append('<input  id="ini_content" type="hidden" name="ini_content"/>');
                $("#ini_content").val(ini_content);


                $(this).append('<input  id="conflicted" type="hidden" name="conflicted" />');

                $(this).append('<input  id="conflict_files" type="hidden" name="conflict_files"/>');
                $("#conflict_files").val(conflict_files)

            });
        });


    </script>
{% endblock %}



{% block head %}
    <link type="text/css" rel="stylesheet" href="{% static  "bower_components/highlightjs/styles/github-gist.css" %}">
    <script src="{% static "bower_components/highlightjs/highlight.pack.min.js" %}"></script>
    <script>hljs.initHighlightingOnLoad();</script>
{% endblock %}



{% block body %}

    {% if err_message is None %}
        <h3>TestScript.ini Content</h3>
    {% endif %}


    {% if err_message %}

        <div class="alert alert-danger" role="alert">
            <h4 class="alert-heading">You got an error!</h4>
            <hr>
            <p>{{ err_message }}</p>

        </div>

        <form id="chose_form" role="form" method="POST">{% csrf_token %}
            <table class="table " id="task-table">
                <tbody>
                <thead>
                <tr>
                    <th scope="col" style="width: 30%">Conflict File</th>
                    <th scope="col" style="width: 70%">TestCase Name</th>

                </tr>
                </thead>
                <tbody>
                {% for k,tasks in cf_tasks.items %}
                    <tr>


                        <td><label class="tasks-lable" style="text-align: left">{{ k|escape }} </label></td>

                        <td>
                            <select class="form-control" name="{{ k |escape }}">
                                {% for task in tasks %}
                                    <option value="{{ task }}">{{ task }}</option>
                                {% endfor %}
                            </select>

                        </td>


                    </tr>


                {% endfor %}

                </tbody>
            </table>

        </form>



    {% endif %}




    {% if err_message is None %}
        <pre>
        <code class="javascript">
            <div id="confirm_data">
                {{ render_str|linebreaks }}
            </div>
       </code>
    </pre>
    {% endif %}

    {% if disable_download %}
        <button id="confirm" type="submit" class="btn btn-primary btn-lg btn-block" form="chose_form"><i
                class="fas fa-check"></i> Confirm
        </button>
    {% else %}
        {#        <a href="{% url "export_task" %}" id="save" class="btn btn-primary btn-lg btn-block" role="button"><i class="fas fa-download"></i>Download</a>#}

        <form id="export_form" action="{% url "export_task" %}" method="post">{% csrf_token %}
            <button id="save" type="submit" class="btn btn-primary btn-lg btn-block"><i
                    class="fas fa-download"></i> Download
            </button>
        </form>
    {% endif %}

{% endblock %}